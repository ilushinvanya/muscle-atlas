<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Buffed Up System</title>
    <link href="./styles.css" rel="stylesheet" type="text/css"/>
    <script src="https://developer.biodigital.com/builds/api/human-api-3.0.0.min.js"></script>
    <script async src="https://cse.google.com/cse.js?cx=60dda72821a344822"></script>
</head>
<body>

<main>
    <div id="info-panel">
        <div class="info-panel__header">
            <button id="google-btn" onclick="setPanel('google')">Google </button>
            <button id="wikipedia-btn" onclick="setPanel('wikipedia')">Wikipedia</button>
            <button id="physiotherapist-btn" onclick="setPanel('physiotherapist')">Physiotherapist.ru</button>
        </div>
        <div id="google">
            <div class="google-header">
                <button onclick="initHuman(maleId)">Stretch</button>
                <button onclick="initHuman(femaleId)">Strengthening</button>
            </div>
            <div class="gcse-search" data-defaultToImageSearch="true" data-gname="storesearch" autoSearchOnLoad="false"></div>
        </div>
        <div id="wikipedia">
            <iframe src=""></iframe>
        </div>
        <div id="physiotherapist">
            <iframe src="https://physiotherapist.ru/muscles/"></iframe>
        </div>
    </div>
    <div id="human-panel">
        <div class="human-panel__header">
            <button id="male-btn" onclick="initHuman(maleId)">Male üßîüèª‚Äç‚ôÇÔ∏è</button>
            <button id="female-btn" onclick="initHuman(femaleId)">Female üë©üèº</button>
        </div>
        <iframe
                id="human"
                frameBorder="0"
                width="600"
                height="450"
                allowFullScreen="true"
                src=""></iframe>
    </div>
    <iframe src="https://www.kenhub.com/en/library/anatomy/anconeus-muscle"/>
</main>
<script>
    const maleId = '5Ac8';
    const femaleId = '5Ac9'

    const maleBtn = document.getElementById('male-btn');
    const femaleBtn = document.getElementById('female-btn');

    const wikipediaDomain = 'https://ru.m.wikipedia.org/w/index.php?search=';
    let wikipediaSearchQuery = '%D0%9C%D1%8B%D1%88%D1%86%D1%8B_%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D1%8B_%D1%87%D0%B5%D0%BB%D0%BE%D0%B2%D0%B5%D0%BA%D0%B0';

    const wikipediaFrameEl = document.querySelector('#wikipedia iframe');

    function setWikipediaSrc() {
        wikipediaFrameEl.src = wikipediaDomain + wikipediaSearchQuery;
    }


    function onClickMuscle(muscleId) {
        const googleSearchInput = google.search.cse.element.getElement('storesearch');
        console.log('scene.objectsSelected event: ', muscleId);
        let eventName;
        let eventStatus;
        Object.entries(muscleId).forEach(([key, value]) => {
            eventName = key;
            eventStatus = value;
        })
        const reg = new RegExp(/-(\w*)_ID/);
        const regMatch = eventName.match(reg);
        const muscle = regMatch[1];

        console.log(muscle, eventStatus);
        if(eventStatus) {
            const clearMuscle = muscle.replaceAll('_', ' ');
            googleSearchInput.execute(clearMuscle + ' stretching exercise');
            wikipediaSearchQuery = clearMuscle;
            setWikipediaSrc();
        } else {
            googleSearchInput.clearAllResults();
        }
    }

    let human = new HumanAPI('human');

    const initHuman = (modelId) => {
        const bioDigitalPath = 'https://human.biodigital.com/widget/?be=' + modelId + '&ui-tour=false&ui-info=false&ui-fullscreen=false&ui-share=false&uaid=' + modelId;
        document.getElementById('human').src = bioDigitalPath;
        human = new HumanAPI('human');

        maleBtn.classList.remove('active');
        femaleBtn.classList.remove('active');
        if(modelId === maleId) {
            maleBtn.classList.add('active');
        }
        if(modelId === femaleId) {
            femaleBtn.classList.add('active');
        }

        const objectID = [];
        const objectName= [];
        human.send('scene.info', (data) => {
            const sceneObjects = data.objects;
            // console.log(sceneObjects.filter(obj => obj.available))
            let available = 0;
            let noAvailable = 0;
            //get list of object names and IDs
            for (var objectId in sceneObjects) {
                var object = sceneObjects[objectId];
                var id = object.objectId;
                var name = object.name;
                if(object.available) {
                    objectID.push(id);
                    objectName.push(name);
                    available++;
                } else {
                    noAvailable++;
                }
            }
            console.log('available', available)
            console.log('noAvailable', noAvailable)
            // create display list of object names
            // var table = document.getElementById('list');
            // for(var i = 0; i < objectName.length; i++){
            //     var row = table.insertRow(i);
            //     var cell = row.insertCell(0);
            //     cell.innerHTML = objectName[i];
            // }
        });
        human.on('scene.objectsSelected', onClickMuscle)
        // human.on('scene.objectsSelected', (pickEvent) => {
        //     console.log('scene.objectsSelected event: ', pickEvent);
        //     let eventName;
        //     let eventStatus;
        //     Object.entries(pickEvent).forEach(([key, value]) => {
        //         eventName = key;
        //         eventStatus = value;
        //     })
        //     const reg = new RegExp(/-(\w*)_ID/);
        //     const regMatch = eventName.match(reg);
        //     const muscle = regMatch[1];
        //     const element = google.search.cse.element.getElement('storesearch');
        //     console.log(muscle, eventStatus);
        //     if(eventStatus) {
        //         const clearMuscle = muscle.replaceAll('_', ' ');
        //         element.execute(clearMuscle + ' stretching exercise');
        //         wikipediaSearchQuery = clearMuscle;
        //         setWikipediaSrc();
        //         // –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
        //         // const dataToSend = eventName;
        //
        //         // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç FormData –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–≥–æ –¥–∞–Ω–Ω—ã–µ
        //         // const formData = new FormData();
        //         // formData.append('data', dataToSend);
        //
        //         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        //         // fetch('save_data.php', {
        //         //     method: 'POST',
        //         //     body: formData
        //         // })
        //         //         .then(response => response.json())
        //         //         .then(result => {
        //         //             console.log(result); // –í—ã–≤–æ–¥–∏–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        //         //         })
        //         //         .catch(error => {
        //         //             console.error('Error:', error);
        //         //         });
        //     } else {
        //         element.clearAllResults();
        //     }
        //
        // });
    }
    initHuman(femaleId);




    const googleBtnEl = document.getElementById('google-btn');
    const wikipediaBtnEl = document.getElementById('wikipedia-btn');
    const physiotherapistBtnEl = document.getElementById('physiotherapist-btn');

    const panelGoogleEl = document.getElementById('google');
    const panelWikipediaEl = document.getElementById('wikipedia');
    const panelPhysiotherapistEl = document.getElementById('physiotherapist');

    const elements = {
        google: {
            button: googleBtnEl,
            panel: panelGoogleEl
        },
        wikipedia: {
            button: wikipediaBtnEl,
            panel: panelWikipediaEl
        },
        physiotherapist: {
            button: physiotherapistBtnEl,
            panel: panelPhysiotherapistEl
        }
    }

    function setPanel(name) {
        allHide();
        toggleElement(name, true);
    }
    function allHide() {
        toggleElement('google', false);
        toggleElement('wikipedia', false);
        toggleElement('physiotherapist', false);
    }
    function toggleElement(name, visible) {
        if(visible) {
            elements[name].button.classList.add('active');
            elements[name].panel.classList.remove('hidden');
        }
        else {
            elements[name].button.classList.remove('active');
            elements[name].panel.classList.add('hidden');
        }
    }
    setPanel('wikipedia')

</script>
</body>
</html>
